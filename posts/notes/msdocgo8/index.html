<!doctype html><html><head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>[MS-Doc-Go] 8 Testing - lunarwhite</title><link rel=icon type=image/png href=favicon/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Notes for awesome courses offered by Microsoft.">
<meta property="og:image" content>
<meta property="og:title" content="[MS-Doc-Go] 8 Testing">
<meta property="og:description" content="Notes for awesome courses offered by Microsoft.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://lunarwhite.github.io/posts/notes/msdocgo8/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-09-04T21:06:11+00:00">
<meta property="article:modified_time" content="2021-09-04T21:06:11+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="[MS-Doc-Go] 8 Testing">
<meta name=twitter:description content="Notes for awesome courses offered by Microsoft.">
<script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet>
<link rel=stylesheet type=text/css media=screen href=https://lunarwhite.github.io/css/main.b787af43728695b428289b03901b2f1178d1db0f557c3284a5b068337d45655e.css>
<link disabled id=dark-mode-theme rel=stylesheet href=https://lunarwhite.github.io/css/dark.ce33575c8d9416a29a0c0f11d9c58c1ca865ac0b6e5ab9b37c0e3d89c5a5e4e1.css>
</head>
<body>
<div class=content><header>
<div class=main>
<a href=https://lunarwhite.github.io/>lunarwhite</a>
</div>
<nav>
<a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
/ <a id=dark-mode-toggle><i data-feather=sun></i></a>
</nav>
</header>
<main>
<article>
<div class=title>
<h1 class=title>[MS-Doc-Go] 8 Testing</h1>
<div class=meta>Posted on Sep 4, 2021</div>
</div>
<section class=body>
<blockquote>
<p><a href=https://docs.microsoft.com/en-us/learn/modules/go-write-test-program/>Write and test a program in Go</a></p>
</blockquote>
<h2 id=81-outline-the-online-bank-project>8.1 Outline the online bank project</h2>
<h3 id=811-define-the-features-and-requirements>8.1.1 Define the features and requirements</h3>
<ul>
<li>We&rsquo;ll create two projects: one for the program&rsquo;s core logic and another one to expose logic through a Web API. Imagine that you&rsquo;re now part of a team that&rsquo;s building an online bank system</li>
<li>The online bank system will:
<ul>
<li>Enable customers to create an account</li>
<li>Enable customers to withdraw money</li>
<li>Enable customers to transfer money to another account</li>
<li>Provide an account statement with customer data and a final balance</li>
<li>Expose a Web API through an endpoint to print an account statement</li>
</ul>
</li>
</ul>
<h3 id=812-create-the-initial-project-files>8.1.2 Create the initial project files</h3>
<ul>
<li>File structure:</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>$GOPATH/
  src/
    bankcore/
      go.mod
      bank.go
    bankapi/
      go.mod
      main.go
</code></pre></div><ul>
<li>Create <code>bankcore/go.mod</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>module</span> <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>msft</span><span style=color:#f92672>/</span><span style=color:#a6e22e>bank</span>

<span style=color:#66d9ef>go</span> <span style=color:#ae81ff>1.14</span>
</code></pre></div><ul>
<li>Create <code>bankcore/bank.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>bank</span>

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Hello</span>() <span style=color:#66d9ef>string</span> {
  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hey! I&#39;m working!&#34;</span>
}
</code></pre></div><ul>
<li>Create <code>bankapi/go.mod</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>module</span> <span style=color:#a6e22e>bankapi</span>

<span style=color:#66d9ef>go</span> <span style=color:#ae81ff>1.14</span>

<span style=color:#a6e22e>require</span> (
    <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>msft</span><span style=color:#f92672>/</span><span style=color:#a6e22e>bank</span> <span style=color:#a6e22e>v0</span><span style=color:#ae81ff>.0.1</span>
)

<span style=color:#a6e22e>replace</span> <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>msft</span><span style=color:#f92672>/</span><span style=color:#a6e22e>bank</span> =&gt; ..<span style=color:#f92672>/</span><span style=color:#a6e22e>bankcore</span>
</code></pre></div><ul>
<li>Create <code>bankapi/main.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
  <span style=color:#e6db74>&#34;fmt&#34;</span>

  <span style=color:#e6db74>&#34;github.com/msft/bank&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>bank</span>.<span style=color:#a6e22e>Hello</span>())
}
</code></pre></div><h2 id=82-get-started-with-writing-tests>8.2 Get started with writing tests</h2>
<h3 id=821-create-the-test-file>8.2.1 Create the test file</h3>
<ul>
<li>The file&rsquo;s name has to finish with <code>_test.go</code>. Additionally, every test that you want to write has to be a function that starts with <code>Test</code>, like <code>TestDeposit</code></li>
<li>Create <code>bankcore/bank_test.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>bank</span>

<span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;testing&#34;</span>

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAccount</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {

}
</code></pre></div><ul>
<li>Run the tests in verbose mode, in the <code>$GOPATH/src/bankcore/</code> location. Go will look for all the <code>*_test.go</code> files to run the tests</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>go</span> <span style=color:#a6e22e>test</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>v</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>=== RUN   TestAccount
--- PASS: TestAccount (0.00s)
PASS
ok      github.com/msft/bank    0.391s
</code></pre></div><h3 id=822-write-a-failing-test>8.2.2 Write a failing test</h3>
<ul>
<li>Before we write any code, let&rsquo;s first write a failing test for it by using TDD(test-driven development). Modify the <code>TestAccount</code> function:</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>bank</span>

<span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;testing&#34;</span>

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAccount</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#a6e22e>account</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Account</span>{
        <span style=color:#a6e22e>Customer</span>: <span style=color:#a6e22e>Customer</span>{
            <span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;John&#34;</span>,
            <span style=color:#a6e22e>Address</span>: <span style=color:#e6db74>&#34;Los Angeles, California&#34;</span>,
            <span style=color:#a6e22e>Phone</span>:   <span style=color:#e6db74>&#34;(213) 555 0147&#34;</span>,
        },
        <span style=color:#a6e22e>Number</span>:  <span style=color:#ae81ff>1001</span>,
        <span style=color:#a6e22e>Balance</span>: <span style=color:#ae81ff>0</span>,
    }

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Name</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;can&#39;t create an Account object&#34;</span>)
    }
}
</code></pre></div><h2 id=83-write-the-bank-core-package>8.3 Write the bank core package</h2>
<h3 id=831-create-structures-for-customers-and-accounts>8.3.1 Create structures for customers and accounts</h3>
<ul>
<li>Add into <code>bankcore/bank.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Customer</span> <span style=color:#66d9ef>struct</span> {
  <span style=color:#a6e22e>Name</span>    <span style=color:#66d9ef>string</span>
  <span style=color:#a6e22e>Address</span> <span style=color:#66d9ef>string</span>
  <span style=color:#a6e22e>Phone</span>   <span style=color:#66d9ef>string</span>
}

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Account</span> <span style=color:#66d9ef>struct</span> {
  <span style=color:#a6e22e>Customer</span>
  <span style=color:#a6e22e>Number</span> <span style=color:#66d9ef>int32</span>
  <span style=color:#a6e22e>Balance</span> <span style=color:#66d9ef>float64</span>
}
</code></pre></div><ul>
<li>Run <code>go test -v</code>, in the <code>$GOPATH/src/bankcore/</code> location</li>
</ul>
<h3 id=832-implement-the-deposit-method>8.3.2 Implement the deposit method</h3>
<ul>
<li>Add into <code>bankcore/bank_test.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestDeposit</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#a6e22e>account</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Account</span>{
        <span style=color:#a6e22e>Customer</span>: <span style=color:#a6e22e>Customer</span>{
            <span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;John&#34;</span>,
            <span style=color:#a6e22e>Address</span>: <span style=color:#e6db74>&#34;Los Angeles, California&#34;</span>,
            <span style=color:#a6e22e>Phone</span>:   <span style=color:#e6db74>&#34;(213) 555 0147&#34;</span>,
        },
        <span style=color:#a6e22e>Number</span>:  <span style=color:#ae81ff>1001</span>,
        <span style=color:#a6e22e>Balance</span>: <span style=color:#ae81ff>0</span>,
    }

    <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Deposit</span>(<span style=color:#ae81ff>10</span>)

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Balance</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>10</span> {
        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;balance is not being updated after a deposit&#34;</span>)
    }
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestDepositInvalid</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#a6e22e>account</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Account</span>{
        <span style=color:#a6e22e>Customer</span>: <span style=color:#a6e22e>Customer</span>{
            <span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;John&#34;</span>,
            <span style=color:#a6e22e>Address</span>: <span style=color:#e6db74>&#34;Los Angeles, California&#34;</span>,
            <span style=color:#a6e22e>Phone</span>:   <span style=color:#e6db74>&#34;(213) 555 0147&#34;</span>,
        },
        <span style=color:#a6e22e>Number</span>:  <span style=color:#ae81ff>1001</span>,
        <span style=color:#a6e22e>Balance</span>: <span style=color:#ae81ff>0</span>,
    }

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Deposit</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;only positive numbers should be allowed to deposit&#34;</span>)
    }
}
</code></pre></div><ul>
<li>Add into <code>bankcore/bank.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Deposit ...
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>a</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Account</span>) <span style=color:#a6e22e>Deposit</span>(<span style=color:#a6e22e>amount</span> <span style=color:#66d9ef>float64</span>) <span style=color:#66d9ef>error</span> {
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>amount</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;the amount to deposit should be greater than zero&#34;</span>)
    }

    <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Balance</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>amount</span>
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><ul>
<li>Run <code>go test -v</code>, in the <code>$GOPATH/src/bankcore/</code> location</li>
</ul>
<h3 id=833-implement-the-withdraw-method>8.3.3 Implement the withdraw method</h3>
<ul>
<li>Add into <code>bankcore/bank_test.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestWithdraw</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
    <span style=color:#a6e22e>account</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Account</span>{
        <span style=color:#a6e22e>Customer</span>: <span style=color:#a6e22e>Customer</span>{
            <span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;John&#34;</span>,
            <span style=color:#a6e22e>Address</span>: <span style=color:#e6db74>&#34;Los Angeles, California&#34;</span>,
            <span style=color:#a6e22e>Phone</span>:   <span style=color:#e6db74>&#34;(213) 555 0147&#34;</span>,
        },
        <span style=color:#a6e22e>Number</span>:  <span style=color:#ae81ff>1001</span>,
        <span style=color:#a6e22e>Balance</span>: <span style=color:#ae81ff>0</span>,
    }

    <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Deposit</span>(<span style=color:#ae81ff>10</span>)
    <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Withdraw</span>(<span style=color:#ae81ff>10</span>)

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Balance</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;balance is not being updated after withdraw&#34;</span>)
    }
}
</code></pre></div><ul>
<li>Add into <code>bankcore/bank.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Withdraw ...
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>a</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Account</span>) <span style=color:#a6e22e>Withdraw</span>(<span style=color:#a6e22e>amount</span> <span style=color:#66d9ef>float64</span>) <span style=color:#66d9ef>error</span> {
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>amount</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;the amount to withdraw should be greater than zero&#34;</span>)
    }

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Balance</span> &lt; <span style=color:#a6e22e>amount</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;the amount to withdraw should be greater than the account&#39;s balance&#34;</span>)
    }

    <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Balance</span> <span style=color:#f92672>-=</span> <span style=color:#a6e22e>amount</span>
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><ul>
<li>Run <code>go test -v</code>, in the <code>$GOPATH/src/bankcore/</code> location</li>
</ul>
<h3 id=834-implement-the-statement-method>8.3.4 Implement the statement method</h3>
<ul>
<li>Add into <code>bankc/bank_test.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Statement ...
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>a</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Account</span>) <span style=color:#a6e22e>Statement</span>() <span style=color:#66d9ef>string</span> {
    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%v - %v - %v&#34;</span>, <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Number</span>, <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Balance</span>)
}
</code></pre></div><ul>
<li>Add into <code>bankcore/bank.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// Withdraw ...
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>a</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Account</span>) <span style=color:#a6e22e>Withdraw</span>(<span style=color:#a6e22e>amount</span> <span style=color:#66d9ef>float64</span>) <span style=color:#66d9ef>error</span> {
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>amount</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;the amount to withdraw should be greater than zero&#34;</span>)
    }

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Balance</span> &lt; <span style=color:#a6e22e>amount</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;the amount to withdraw should be greater than the account&#39;s balance&#34;</span>)
    }

    <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Balance</span> <span style=color:#f92672>-=</span> <span style=color:#a6e22e>amount</span>
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><ul>
<li>Run <code>go test -v</code>, in the <code>$GOPATH/src/bankcore/</code> location</li>
</ul>
<h2 id=84-write-the-bank-api>8.4 Write the bank API</h2>
<h3 id=841-set-up-an-account-in-memory>8.4.1 Set up an account in memory</h3>
<ul>
<li>Add into <code>bankapi/main.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
    <span style=color:#e6db74>&#34;github.com/msft/bank&#34;</span>
)

<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>accounts</span> = <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>float64</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>bank</span>.<span style=color:#a6e22e>Account</span>{}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#a6e22e>accounts</span>[<span style=color:#ae81ff>1001</span>] = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>bank</span>.<span style=color:#a6e22e>Account</span>{
        <span style=color:#a6e22e>Customer</span>: <span style=color:#a6e22e>bank</span>.<span style=color:#a6e22e>Customer</span>{
            <span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;John&#34;</span>,
            <span style=color:#a6e22e>Address</span>: <span style=color:#e6db74>&#34;Los Angeles, California&#34;</span>,
            <span style=color:#a6e22e>Phone</span>:   <span style=color:#e6db74>&#34;(213) 555 0147&#34;</span>,
        },
        <span style=color:#a6e22e>Number</span>: <span style=color:#ae81ff>1001</span>,
    }
}
</code></pre></div><h3 id=842-expose-the-statement-method>8.4.2 Expose the statement method</h3>
<ul>
<li>Add into <code>bankapi/main.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>statement</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
    <span style=color:#a6e22e>numberqs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Query</span>().<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;number&#34;</span>)

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>numberqs</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Account number is missing!&#34;</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>number</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseFloat</span>(<span style=color:#a6e22e>numberqs</span>, <span style=color:#ae81ff>64</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Invalid account number!&#34;</span>)
    } <span style=color:#66d9ef>else</span> {
        <span style=color:#a6e22e>account</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>accounts</span>[<span style=color:#a6e22e>number</span>]
        <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Account with number %v can&#39;t be found!&#34;</span>, <span style=color:#a6e22e>number</span>)
        } <span style=color:#66d9ef>else</span> {
            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Statement</span>())
        }
    }
}
</code></pre></div><h3 id=843-expose-the-deposit-method>8.4.3 Expose the deposit method</h3>
<ul>
<li>Add into <code>bankapi/main.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>deposit</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
    <span style=color:#a6e22e>numberqs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Query</span>().<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;number&#34;</span>)
    <span style=color:#a6e22e>amountqs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Query</span>().<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;amount&#34;</span>)

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>numberqs</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Account number is missing!&#34;</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>number</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseFloat</span>(<span style=color:#a6e22e>numberqs</span>, <span style=color:#ae81ff>64</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Invalid account number!&#34;</span>)
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>amount</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseFloat</span>(<span style=color:#a6e22e>amountqs</span>, <span style=color:#ae81ff>64</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Invalid amount number!&#34;</span>)
    } <span style=color:#66d9ef>else</span> {
        <span style=color:#a6e22e>account</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>accounts</span>[<span style=color:#a6e22e>number</span>]
        <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Account with number %v can&#39;t be found!&#34;</span>, <span style=color:#a6e22e>number</span>)
        } <span style=color:#66d9ef>else</span> {
            <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Deposit</span>(<span style=color:#a6e22e>amount</span>)
            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;%v&#34;</span>, <span style=color:#a6e22e>err</span>)
            } <span style=color:#66d9ef>else</span> {
                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Statement</span>())
            }
        }
    }
}
</code></pre></div><h3 id=844-expose-the-withdraw-method>8.4.4 Expose the withdraw method</h3>
<ul>
<li>Add into <code>bankapi/main.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>withdraw</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
    <span style=color:#a6e22e>numberqs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Query</span>().<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;number&#34;</span>)
    <span style=color:#a6e22e>amountqs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Query</span>().<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;amount&#34;</span>)

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>numberqs</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Account number is missing!&#34;</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>number</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseFloat</span>(<span style=color:#a6e22e>numberqs</span>, <span style=color:#ae81ff>64</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Invalid account number!&#34;</span>)
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>amount</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseFloat</span>(<span style=color:#a6e22e>amountqs</span>, <span style=color:#ae81ff>64</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Invalid amount number!&#34;</span>)
    } <span style=color:#66d9ef>else</span> {
        <span style=color:#a6e22e>account</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>accounts</span>[<span style=color:#a6e22e>number</span>]
        <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Account with number %v can&#39;t be found!&#34;</span>, <span style=color:#a6e22e>number</span>)
        } <span style=color:#66d9ef>else</span> {
            <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Withdraw</span>(<span style=color:#a6e22e>amount</span>)
            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;%v&#34;</span>, <span style=color:#a6e22e>err</span>)
            } <span style=color:#66d9ef>else</span> {
                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>account</span>.<span style=color:#a6e22e>Statement</span>())
            }
        }
    }
}
</code></pre></div><ul>
<li>Add into <code>bankapi/main.go</code></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#a6e22e>accounts</span>[<span style=color:#ae81ff>1001</span>] = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>bank</span>.<span style=color:#a6e22e>Account</span>{
        <span style=color:#a6e22e>Customer</span>: <span style=color:#a6e22e>bank</span>.<span style=color:#a6e22e>Customer</span>{
            <span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;John&#34;</span>,
            <span style=color:#a6e22e>Address</span>: <span style=color:#e6db74>&#34;Los Angeles, California&#34;</span>,
            <span style=color:#a6e22e>Phone</span>:   <span style=color:#e6db74>&#34;(213) 555 0147&#34;</span>,
        },
        <span style=color:#a6e22e>Number</span>: <span style=color:#ae81ff>1001</span>,
    }

    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/statement&#34;</span>, <span style=color:#a6e22e>statement</span>)
    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/deposit&#34;</span>, <span style=color:#a6e22e>deposit</span>)
    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/withdraw&#34;</span>, <span style=color:#a6e22e>withdraw</span>)
    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;localhost:8000&#34;</span>, <span style=color:#66d9ef>nil</span>))
}
</code></pre></div><ul>
<li>Run the following command</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl http://localhost:8000/deposit<span style=color:#ae81ff>\?</span>number<span style=color:#f92672>=</span>1001&amp;amount<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>
curl http://localhost:8000/deposit<span style=color:#ae81ff>\?</span>number<span style=color:#f92672>=</span>1001&amp;amount<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>
curl http://localhost:8000/deposit<span style=color:#ae81ff>\?</span>number<span style=color:#f92672>=</span>1001&amp;amount<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>
curl http://localhost:8000/withdraw<span style=color:#ae81ff>\?</span>number<span style=color:#f92672>=</span>1001&amp;amount<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>1001 - John - 200
</code></pre></div>
</section>
<div class=post-tags>
<nav class="nav tags">
<ul class=tags>
<li><a href=/tags/awesome-course>awesome-course</a></li>
<li><a href=/tags/golang>golang</a></li>
</ul>
</nav>
</div>
</article>
</main>
<footer>
<hr><a class=soc href=https://www.linkedin.com/in/yuedongwoo/ title=LinkedIn><i data-feather=linkedin></i></a>|<a class=soc href=https://github.com/lunarwhite title=GitHub><i data-feather=github></i></a>|<a class=soc href title=Twitter><i data-feather=twitter></i></a>|<a class=soc href title=Instagram><i data-feather=instagram></i></a>|<a class=soc href title=Bilibili><i data-feather=tv></i></a>|<a class=soc href=https://www.zhihu.com/people/wydnlz title=Zhihu><i data-feather=link></i></a>|⚡️
2021 © lunarwhite | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a>
</footer>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-80H8N7NN50','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script src=https://lunarwhite.github.io/js/toggle.dark.js></script>
<script>feather.replace()</script>
<script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']],processEscapes:!0,processEnvironments:!0,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var b=MathJax.Hub.getAllJax(),a;for(a=0;a<b.length;a+=1)b[a].SourceElement().parentNode.className+=' has-jax'}),MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}})</script></div>
</body>
</html>